<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Invitation-Only</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex, nofollow" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: #050509;
      display: flex;
      justify-content: center;
      padding: 24px 16px;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      color: #f5f5f5;
      min-height: 100vh;
    }

    .wrap {
      width: 100%;
      max-width: 520px;
    }

    .poster-frame {
      position: relative;
      width: 100%;
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.08);
      background: #050509;
    }

    .poster-bg {
      width: 100%;
      display: block;
    }

    .text-layer {
      position: absolute;
      inset: 0;
      margin: auto;
      width: 100%;
      height: 100%;
      object-fit: contain;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.6s ease;
    }

    .text-layer.active {
      opacity: 1;
    }

    .hint {
      font-size: 0.75rem;
      color: #888;
      text-align: center;
      margin-top: 10px;
    }

    .footer {
      font-size: 0.7rem;
      color: #666;
      text-align: center;
      margin-top: 4px;
    }

    .apply-area {
      margin-top: 14px;
      text-align: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
    }

    .apply-area.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .apply-button {
      display: inline-block;
      padding: 8px 20px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.3);
      background: #0b0b11;
      font-size: 0.8rem;
      text-decoration: none;
      color: #f5f5f5;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .apply-button:hover {
      background: #181824;
    }
  </style>
</head>
<body>
  <main class="wrap">
    <div class="poster-frame">
      <img class="poster-bg" src="bg-poster.png" alt="The Hidden Stage Background" />

      <!-- 텍스트 순서: 0 → 5 -->
      <img class="text-layer active" src="text-0.png" alt="Text 0" />
      <img class="text-layer" src="text-1.png" alt="Text 1" />
      <img class="text-layer" src="text-2.png" alt="Text 2" />
      <img class="text-layer" src="text-3.png" alt="Text 3" />
      <img class="text-layer" src="text-4.png" alt="Text 4" />
      <img class="text-layer" src="text-5.png" alt="Text 5" />
    </div>

    <p class="hint">
      화면을 <strong>탭/클릭</strong>하거나 <strong>스크롤</strong>해 주세요
    </p>

    <p class="footer">
      Invitation-Only
    </p>

    <!-- 최종 장에서만 나타나게 -->
    <div class="apply-area">
      <a
        class="apply-button"
        href="https://forms.gle/Ux5b3xLe1nCsZYDm9"
        target="_blank"
        rel="noopener noreferrer"
      >
        Application Form
      </a>
    </div>
  </main>

  <audio id="bgm" src="bgm.mp3" loop></audio>

  <script>
    const layers = Array.from(document.querySelectorAll('.text-layer'));
    let currentIndex = 0;
    let lastTriggerTime = 0;
    const MIN_INTERVAL = 700;

    const bgm = document.getElementById('bgm');
    let bgmStarted = false;

    function startMusic() {
      if (!bgmStarted) {
        bgm.volume = 0.7;
        bgm.play().catch(() => {});
        bgmStarted = true;
      }
    }

    const applyArea = document.querySelector('.apply-area');

    function showSlide(index) {
      layers.forEach((layer, idx) => {
        layer.classList.toggle('active', idx === index);
      });

      // 마지막(text-5)에서만 신청 버튼 표시
      applyArea.classList.toggle('visible', index === layers.length - 1);
    }

    function nextSlide() {
      const now = Date.now();
      if (now - lastTriggerTime < MIN_INTERVAL) return;
      lastTriggerTime = now;

      if (currentIndex < layers.length - 1) {
        currentIndex++;
        showSlide(currentIndex);
      }
    }

    function handleAdvance() {
      startMusic();
      nextSlide();
    }

    document.addEventListener('click', handleAdvance);
    document.addEventListener('keydown', (e) => {
      if ([' ', 'Enter', 'ArrowDown', 'ArrowRight'].includes(e.key)) {
        e.preventDefault();
        handleAdvance();
      }
    });
    document.addEventListener('wheel', (e) => {
      if (Math.abs(e.deltaY) > 10) {
        e.preventDefault();
        handleAdvance();
      }
    }, { passive: false });

    let touchStartY = null;
    document.addEventListener('touchstart', (e) => {
      if (e.touches.length === 1) {
        touchStartY = e.touches[0].clientY;
      }
    }, { passive: true });

    document.addEventListener('touchend', (e) => {
      if (touchStartY === null) {
        handleAdvance();
        return;
      }
      const touchEndY = e.changedTouches[0].clientY;
      if (Math.abs(touchStartY - touchEndY) > 20) {
        handleAdvance();
      } else {
        handleAdvance();
      }
      touchStartY = null;
    });

    showSlide(currentIndex);
  </script>
</body>
</html>
